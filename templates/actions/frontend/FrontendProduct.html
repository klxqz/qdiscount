<style>
    .qdiscount-product-block{
        margin: 10px 0;
        overflow: auto; display: block;
    }
    .qdiscount-product-block table{
        border: none !important;
    }
    .qdiscount-product-block table td{
        border: none !important; padding: 0 !important;
    }
    .qdiscount-product-block .qdiscount-variant{
        margin-right: 5px;
    }
    .qdiscount-product-block .old-price{
        text-decoration: line-through; font-size: 75%; color: #777;
    }
    .qdiscount-product-block .new-price{
        font-size: 120%; font-weight: bold; color: #ff0000;
    }
</style>

<div class="qdiscount-product-block">
    <table>
        {foreach $product.skus as $sku}
            {foreach $items as $item}
                {if $sku.id == $item.sku_id}
                    <tr class="qdiscount-item" data-sku-id="{$sku.id}">
                        <td class="nowrap"><input class="qdiscount-variant" type="radio" name="qdiscount_variant" value="{$item.count}" /></td>
                        <td class="nowrap">
                            <div class="new-price">{shop_currency($item.price)}</div>
                            <div class="old-price">{shop_currency($sku.price)}</div>
                        </td>
                        <td class="nowrap">&nbsp;<span class="gray">×</span><input size="1" type="text" value="{$item.count}" disabled="disabled" /></td>
                        <td>
                            &nbsp;=&nbsp;
                        </td>
                        <td class="nowrap">
                            <div class="new-price">{shop_currency($item.count*$item.price)}</div>
                            <div class="old-price">{shop_currency($item.count*$sku.price)}</div>
                        </td>
                    </tr>
                {/if}
            {/foreach}
        {/foreach}
    </table>
    <em class="qdiscount-hint">Цена со скидкой при покупке указанного количества</em>
</div>

<script type="text/javascript">
    (function ($) {
        $.qdiscount_plugin = {
            options: {},
            init: function (options) {
                this.options = options;
                this.changeSkus();
                $(".skus input[type=radio]:checked").click();
                this.changeFeatures();
                $(".sku-feature").change();
                this.changeDiscountVariant();
            },
            changeSkus: function () {
                $(".skus input[type=radio]").click(function () {
                    var sku_id = $(this).val();
                    $('.qdiscount-hint').hide();
                    $('.qdiscount-item').hide();
                    $('.qdiscount-item[data-sku-id=' + sku_id + ']').show();
                    if ($('.qdiscount-item:visible').length > 0) {
                        $('.qdiscount-hint').show();
                    }
                });
            },
            changeFeatures: function () {
                var self = this;
                $(".sku-feature").change(function () {
                    var key = "";
                    $(".sku-feature").each(function () {
                        key += $(this).data('feature-id') + ':' + $(this).val() + ';';
                    });
                    var sku = self.options.features[key];
                    if (sku) {
                        $('.qdiscount-hint').hide();
                        $('.qdiscount-item').hide();
                        $('.qdiscount-item[data-sku-id=' + sku.id + ']').show();
                        if ($('.qdiscount-item:visible').length > 0) {
                            $('.qdiscount-hint').show();
                        }
                    }
                });
            },
            changeDiscountVariant: function () {
                var form = $(this.options.form_selector);
                $('.qdiscount-variant').click(function () {
                    if (!$(this).data('checked')) {
                        $('.qdiscount-variant').data('checked', false);
                        $(this).attr('checked', true);
                        $(this).data('checked', true);
                    } else {
                        $(this).removeAttr('checked');
                        $(this).data('checked', false);
                    }

                    if (!form.find('input[name=quantity]').length) {
                        form.append('<input type="hidden" name="quantity" value="1" />');
                    }
                    if ($(this).data('checked')) {
                        form.find('input[name=quantity]').val($(this).val());
                    } else {
                        form.find('input[name=quantity]').val(1);
                    }
                });
            }
        };
    })(jQuery);

    $(function () {
        $.qdiscount_plugin.init({
    {if $product.sku_type}
        features: {json_encode($sku_features_selectable)},
    {/if}
        form_selector: '#cart-form'
    });
    });
</script>